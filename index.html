<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Strategic Mortgage Planner - NPV, DTI & Equity Forecaster</title>

    <!-- SEO & Social Meta Tags -->
    <meta name="description" content="An advanced mortgage calculator to analyze payoff scenarios, equity growth, Debt-to-Income (DTI), Net Present Value (NPV) of costs, and potential refinance options.">
    <link rel="icon" href="data:image/svg+xml,%3Csvg width='100' height='100' viewBox='0 0 100 100' fill='none' xmlns='http://www.w3.org/2000/svg'%3E%3Crect width='100' height='100' rx='20' fill='%231C768F'/%3E%3Cpath d='M50 25L25 45V75H41.6667V58.3333H58.3333V75H75V45L50 25Z' stroke='white' stroke-width='5' stroke-linejoin='round'/%3E%3Cpath d='M40 65L50 55L60 65' stroke='white' stroke-width='5' stroke-linecap='round' stroke-linejoin='round'/%3E%3Cpath d='M50 55V45' stroke='white' stroke-width='5' stroke-linecap='round' stroke-linejoin='round'/%3E%3C/svg%3E">

    <!-- Libraries -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.3/dist/chart.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.8.2/jspdf.plugin.autotable.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;900&display=swap" rel="stylesheet">
    
    <!-- App Configuration -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'primary': '#1C768F', 'accent': '#1e8749', 'npv': '#E86F00',
                        'dti-safe': '#10b981', 'dti-high': '#f59e0b', 'dti-critical': '#ef4444',
                    },
                    fontFamily: { sans: ['Inter', 'sans-serif'] }
                }
            }
        }
    </script>

    <!-- Global Stylesheet -->
    <link rel="stylesheet" href="style.css">

    <!-- JSON-LD Structured Data -->
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@graph": [
        {
          "@type": ["FinancialService", "WebApplication"],
          "name": "Strategic Mortgage Planner",
          "alternateName": "Advanced Mortgage Calculator with NPV, DTI & Equity Forecaster",
          "description": "An advanced mortgage calculator to analyze payoff scenarios, equity growth, Debt-to-Income (DTI), Net Present Value (NPV) of costs, and potential refinance options.",
          "applicationCategory": "FinanceApplication",
          "operatingSystem": "Any (Web Application)",
          "serviceType": "Mortgage Calculator",
          "provider": {
            "@type": "Organization",
            "name": "Toolblaster.com",
            "url": "https://toolblaster.com"
          },
          "offers": {
            "@type": "Offer",
            "price": "0",
            "priceCurrency": "USD"
          }
        },
        {
          "@type": "BreadcrumbList",
          "itemListElement": [{
            "@type": "ListItem",
            "position": 1,
            "name": "Toolblaster Home",
            "item": "https://toolblaster.com"
          },{
            "@type": "ListItem",
            "position": 2,
            "name": "Strategic Mortgage Planner"
          }]
        },
        {
          "@type": "FAQPage",
          "mainEntity": [{
            "@type": "Question",
            "name": "Is it always better to make extra mortgage payments?",
            "acceptedAnswer": {
              "@type": "Answer",
              "text": "Not always. If your mortgage has a very low interest rate, you might get a better return by investing your extra cash elsewhere. Use the NPV (Net Present Value) feature in our calculator to compare the real return on each choice."
            }
          },{
            "@type": "Question",
            "name": "How is this different from a bank's calculator?",
            "acceptedAnswer": {
              "@type": "Answer",
              "text": "Most bank calculators only show you the monthly payment. Ours is a strategic planner that reveals the long-term financial impact of your decisions, focusing on key metrics like home equity, Net Present Value (NPV), and Debt-to-Income (DTI)."
            }
          },{
            "@type": "Question",
            "name": "When should I consider refinancing?",
            "acceptedAnswer": {
              "@type": "Answer",
              "text": "Refinancing is often a good idea if you can significantly lower your interest rate (e.g., by at least 0.75-1%) or if you want to shorten your loan term. Our planner's 'Refinance Scenario' section helps you see if the long-term interest savings outweigh the closing costs."
            }
          },{
            "@type": "Question",
            "name": "How does a bi-weekly payment plan help?",
            "acceptedAnswer": {
              "@type": "Answer",
              "text": "A bi-weekly plan involves making 26 half-payments a year, which equals 13 full monthly payments instead of the standard 12. This extra payment is applied directly to the principal, helping you pay off the loan faster and save a significant amount on interest over the life of the loan."
            }
          },{
            "@type": "Question",
            "name": "What is PMI and how do I get rid of it?",
            "acceptedAnswer": {
              "@type": "Answer",
              "text": "Private Mortgage Insurance (PMI) is typically required if your down payment is less than 20% of the home's value (an LTV over 80%). You can usually request to have PMI removed once your loan balance drops to 80% of the home's original appraised value. Our calculator projects when you are expected to reach this important milestone."
            }
          }]
        },
        {
          "@type": "HowTo",
          "name": "How to Use the Strategic Mortgage Planner",
          "description": "A step-by-step guide to get the most accurate and insightful results from the mortgage planner.",
          "step": [
            {
              "@type": "HowToStep",
              "name": "Start with Your Core Loan Details",
              "text": "Enter your initial loan amount, interest rate, and term. This forms the baseline for all subsequent calculations and scenarios."
            },
            {
              "@type": "HowToStep",
              "name": "Add Your Financial Picture",
              "text": "Input your gross annual income and other monthly debts (like car payments or student loans). This is crucial for the DTI (Debt-to-Income) analysis, showing how your mortgage fits into your overall budget."
            },
            {
              "@type": "HowToStep",
              "name": "Model Future Scenarios",
              "text": "Use the 'PITI, Payoff & Economic Inputs' section to see how extra payments, property appreciation, and inflation (the Discount Rate) impact your wealth over time. This is where you can unlock the true strategic power of the tool."
            }
          ]
        }
      ]
    }
    </script>
</head>
<body>
    <!-- Reusable SVG Icon Definition -->
    <svg width="0" height="0" class="absolute">
      <symbol id="logo-icon" viewBox="0 0 100 100">
        <rect width="100" height="100" rx="20" fill="#1C768F"/>
        <path d="M50 25L25 45V75H41.6667V58.3333H58.3333V75H75V45L50 25Z" stroke="white" stroke-width="5" stroke-linejoin="round"/>
        <path d="M40 65L50 55L60 65" stroke="white" stroke-width="5" stroke-linecap="round" stroke-linejoin="round"/>
        <path d="M50 55V45" stroke="white" stroke-width="5" stroke-linecap="round" stroke-linejoin="round"/>
      </symbol>
    </svg>

    <!-- Global Header -->
    <header class="bg-white/80 backdrop-blur-lg shadow-sm sticky top-0 z-50 no-print">
        <nav class="container mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex items-center justify-center h-14">
                <a href="/" class="flex items-center space-x-2 text-primary hover:opacity-80 transition-opacity">
                    <svg class="h-6 w-6" aria-hidden="true">
                        <use href="#logo-icon"></use>
                    </svg>
                    <span class="font-bold text-lg">
                        <span class="border-b-2 border-primary">Strategic</span> Mortgage Planner
                    </span>
                </a>
            </div>
        </nav>
    </header>

    <!-- Main Content Area -->
    <main class="content-wrapper">
        <div class="calculator-container bg-white p-4 md:p-8 rounded-xl shadow-2xl w-full max-w-6xl mx-auto my-4">
            <div class="text-center bg-sky-50 p-3 rounded-lg mb-4 shadow-sm">
                <h1 class="text-lg md:text-xl font-extrabold text-primary">
                    Mortgage & Financial Planner
                </h1>
                <p class="text-xs text-gray-600 mt-0.5">Mortgage, Affordability, NPV, DTI, Equity & Rent vs. Buy Analysis</p>
            </div>

            <!-- Tab Navigation -->
            <div class="mb-4 border-b border-gray-200">
                <ul class="flex flex-wrap -mb-px text-sm font-medium text-center" id="main-tabs">
                    <li class="mr-2">
                        <button class="inline-block p-4 border-b-2 rounded-t-lg" id="mortgage-tab" type="button">
                            <svg class="w-5 h-5 inline-block mr-1" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M10.707 2.293a1 1 0 00-1.414 0l-7 7a1 1 0 001.414 1.414L4 10.414V17a1 1 0 001 1h2a1 1 0 001-1v-2a1 1 0 011-1h2a1 1 0 011 1v2a1 1 0 001 1h2a1 1 0 001-1v-6.586l.293.293a1 1 0 001.414-1.414l-7-7z"></path></svg>
                            Mortgage Calculator
                        </button>
                    </li>
                    <li class="mr-2">
                        <button class="inline-block p-4 border-b-2 rounded-t-lg" id="affordability-tab" type="button">
                            <svg class="w-5 h-5 inline-block mr-1" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-11a1 1 0 10-2 0v2H7a1 1 0 100 2h2v2a1 1 0 102 0v-2h2a1 1 0 100-2h-2V7z" clip-rule="evenodd"></path></svg>
                            Affordability
                        </button>
                    </li>
                    <li class="mr-2">
                        <button class="inline-block p-4 border-b-2 rounded-t-lg" id="rent-vs-buy-tab" type="button">
                            <svg class="w-5 h-5 inline-block mr-1" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M4 2a2 2 0 00-2 2v12a2 2 0 002 2h12a2 2 0 002-2V4a2 2 0 00-2-2H4zm3 2a1 1 0 011-1h2a1 1 0 110 2H8a1 1 0 01-1-1zm-1 5a1 1 0 011-1h6a1 1 0 110 2H7a1 1 0 01-1-1zm1 3a1 1 0 100 2h6a1 1 0 100-2H7z" clip-rule="evenodd"></path></svg>
                            Rent vs. Buy Comparison
                        </button>
                    </li>
                </ul>
            </div>

            <div id="error-messages" class="hidden p-4 mb-4 text-sm text-red-800 rounded-lg bg-red-50 border border-red-200" role="alert">
                <span class="font-medium">Please correct the following errors:</span>
                <ul id="error-list" class="mt-1.5 ml-4 list-disc list-inside"></ul>
            </div>
            
             <div id="affordability-content" class="hidden">
                <div class="main-grid-layout grid grid-cols-1 gap-6 mt-4 lg:grid-cols-5">
                    <div class="input-column flex flex-col gap-4 lg:col-span-2">
                        <details open class="bg-white rounded-lg shadow-lg border-2 border-cyan-600">
                             <summary class="p-4 border-b border-gray-200 cursor-pointer flex justify-between items-center relative before:content-['+'] open:before:content-['−'] before:absolute before:right-4 before:text-xl">
                                <h2 class="text-base font-bold text-primary">Your Financials</h2>
                            </summary>
                            <div class="p-4 grid grid-cols-1 sm:grid-cols-2 gap-4">
                                <!-- Re-using annualIncome and nonMortgageDebt -->
                                <div class="space-y-1">
                                    <label for="downPaymentAmount" class="block font-medium text-sm text-gray-700">Down Payment (<span id="afford-down-payment-currency"></span>):</label>
                                    <input type="number" id="downPaymentAmount" value="60000" min="0" step="1000" class="w-full p-2 border border-gray-300 rounded-md focus:ring-primary focus:border-primary">
                                </div>
                                <div class="space-y-1">
                                    <label for="desiredFrontEndDTI" class="block font-medium text-sm text-gray-700">Desired Housing DTI (%):</label>
                                    <input type="number" id="desiredFrontEndDTI" value="28" min="10" max="50" step="1" class="w-full p-2 border border-gray-300 rounded-md focus:ring-primary focus:border-primary">
                                </div>
                                <div class="space-y-1 sm:col-span-2">
                                    <label for="desiredBackEndDTI" class="block font-medium text-sm text-gray-700">Desired Total DTI (%):</label>
                                    <input type="number" id="desiredBackEndDTI" value="36" min="10" max="50" step="1" class="w-full p-2 border border-gray-300 rounded-md focus:ring-primary focus:border-primary">
                                </div>
                            </div>
                        </details>
                    </div>

                    <div class="output-column flex flex-col gap-4 lg:col-span-3">
                        <div id="affordability-results" class="p-4 bg-gray-50 rounded-lg shadow-inner border border-gray-200 opacity-0">
                            <h2 class="text-xl sm:text-2xl font-bold text-gray-800 text-center mb-4">Home Affordability Summary</h2>
                             <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-center">
                                <div class="p-4 rounded-lg bg-primary/10 border-2 border-primary/50 shadow">
                                    <p class="text-sm font-medium text-primary">Max Affordable Home Price</p>
                                    <p id="affordableHomePrice" class="text-2xl sm:text-3xl font-extrabold text-primary"></p>
                                </div>
                                <div class="p-2 rounded-lg bg-gray-100 border">
                                    <p class="text-xs font-medium text-gray-600">Max Loan Amount</p>
                                    <p id="affordableLoanAmount" class="text-lg sm:text-xl font-extrabold"></p>
                                </div>
                                <div class="p-2 rounded-lg bg-gray-100 border">
                                    <p class="text-xs font-medium text-gray-600">Estimated Monthly PITI</p>
                                    <p id="affordablePITI" class="text-lg sm:text-xl font-extrabold"></p>
                                </div>
                            </div>
                            <div id="affordability-chart-container" class="mt-4 bg-white rounded-lg shadow-md p-2 h-64">
                                <canvas id="affordabilityChart"></canvas>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div id="mortgage-calculator-content" class="hidden">
                <div class="main-grid-layout grid grid-cols-1 gap-6 mt-4 lg:grid-cols-5">
                    <div class="input-column flex flex-col gap-4 lg:col-span-2">
                        
                        <details open class="bg-white rounded-lg shadow-lg border-2 border-cyan-600">
                            <summary class="p-4 border-b border-gray-200 cursor-pointer flex justify-between items-center relative before:content-['+'] open:before:content-['−'] before:absolute before:right-4 before:text-xl">
                                <h2 class="text-base font-bold text-primary">Loan Core Details</h2>
                            </summary>
                            <div class="input-section grid grid-cols-1 sm:grid-cols-2 gap-4 p-4">
                                <div class="space-y-1">
                                    <label for="loanAmount" class="block font-medium text-sm text-gray-700">Loan Principal (<span id="mc-loan-currency"></span>):</label>
                                    <input type="number" id="loanAmount" value="300000" min="1000" step="1000" class="w-full p-2 border border-gray-300 rounded-md focus:ring-primary focus:border-primary">
                                </div>
                                <div class="space-y-1">
                                    <label for="currency" class="block font-medium text-sm text-gray-700">Currency:</label>
                                    <select id="currency" class="w-full p-2 border border-gray-300 rounded-md focus:ring-primary focus:border-primary h-[42px]">
                                        <option value="USD">USD ($)</option>
                                        <option value="EUR">EUR (€)</option>
                                        <option value="GBP">GBP (£)</option>
                                        <option value="CAD">CAD (C$)</option>
                                        <option value="AUD">AUD (A$)</option>
                                    </select>
                                </div>
                                <div class="space-y-1">
                                    <label for="initialLTV" class="block font-medium text-sm text-gray-700">
                                        <span class="tooltip-container">Initial LTV (%):
                                            <span class="tooltip-icon" tabindex="0" aria-label="Loan-to-Value tooltip">?</span>
                                            <span class="tooltip-text" role="tooltip">Loan-to-Value (LTV) is your loan amount divided by the property's value. An LTV over 80% typically requires PMI.</span>
                                        </span>
                                    </label>
                                    <input type="number" id="initialLTV" value="90" min="5" max="100" step="1" class="w-full p-2 border border-gray-300 rounded-md focus:ring-primary focus:border-primary">
                                </div>
                                <div class="space-y-1">
                                    <label for="interestRate" class="block font-medium text-sm text-gray-700">Annual P&I Rate (%):</label>
                                    <input type="number" id="interestRate" value="6.5" min="0.1" max="25" step="0.1" class="w-full p-2 border border-gray-300 rounded-md focus:ring-primary focus:border-primary">
                                </div>
                                <div class="space-y-1">
                                    <label for="loanTerm" class="block font-medium text-sm text-gray-700">Original Term (Years):</label>
                                    <input type="number" id="loanTerm" value="30" min="5" max="50" class="w-full p-2 border border-gray-300 rounded-md focus:ring-primary focus:border-primary">
                                </div>
                                <div class="space-y-1 col-span-1 sm:col-span-2">
                                    <label for="repaymentFrequency" class="block font-medium text-sm text-gray-700">Frequency (Periods/yr):</label>
                                    <select id="repaymentFrequency" class="w-full p-2 border border-gray-300 rounded-md focus:ring-primary focus:border-primary h-[42px]">
                                        <option value="12">Monthly (12)</option>
                                        <option value="26">Bi-Weekly (26)</option>
                                        <option value="24">Semi-Monthly (24)</option>
                                        <option value="52">Weekly (52)</option>
                                    </select>
                                </div>
                            </div>
                        </details>

                        <details open class="bg-white rounded-lg shadow-lg border-2 border-cyan-600">
                            <summary class="p-4 border-b border-gray-200 cursor-pointer flex justify-between items-center relative before:content-['+'] open:before:content-['−'] before:absolute before:right-4 before:text-xl">
                               <h2 class="text-base font-bold text-dti-safe">Debt-to-Income (DTI) Inputs</h2>
                            </summary>
                            <div class="input-section grid grid-cols-1 sm:grid-cols-2 gap-4 p-4">
                                <div class="space-y-1">
                                    <label for="annualIncome" class="block font-medium text-sm text-gray-700">Annual Gross Income (<span id="dti-income-currency"></span>):</label>
                                    <input type="number" id="annualIncome" value="120000" min="0" step="1000" class="w-full p-2 border border-gray-300 rounded-md focus:ring-dti-safe focus:border-dti-safe">
                                </div>
                                <div class="space-y-1">
                                    <label for="nonMortgageDebt" class="block font-medium text-sm text-gray-700">Monthly Non-Mortgage Debt (<span id="dti-debt-currency"></span>):</label>
                                    <input type="number" id="nonMortgageDebt" value="800" min="0" step="50" class="w-full p-2 border border-gray-300 rounded-md focus:ring-dti-safe focus:border-dti-safe">
                                    <p class="text-xs text-gray-600 mt-1">Car, student, CC payments.</p>
                                </div>
                            </div>
                        </details>

                        <details open class="bg-white rounded-lg shadow-lg border-2 border-cyan-600">
                            <summary class="p-4 border-b border-gray-200 cursor-pointer flex justify-between items-center relative before:content-['+'] open:before:content-['−'] before:absolute before:right-4 before:text-xl">
                                <h2 class="text-base font-bold text-primary">PITI, Payoff & Economic Inputs</h2>
                            </summary>
                            <div class="input-section grid grid-cols-1 sm:grid-cols-2 gap-4 p-4">
                                <div class="space-y-1 col-span-1 sm:col-span-2 bg-accent/10 p-2 rounded-md border border-accent/30">
                                    <label for="appreciationRate" class="block font-bold text-sm text-accent">Annual Property Appreciation (%):</label>
                                    <input type="number" id="appreciationRate" value="3.5" min="0" max="15" step="0.1" class="w-full p-2 border border-accent/50 rounded-md focus:ring-accent focus:border-accent">
                                </div>
                                <div class="space-y-1 col-span-1 sm:col-span-2 bg-npv/10 p-2 rounded-md border border-npv/30">
                                    <label for="discountRate" class="block font-bold text-sm text-npv">
                                         <span class="tooltip-container">Annual Investment/Inflation Rate (%):
                                            <span class="tooltip-icon" tabindex="0" aria-label="Discount Rate tooltip">?</span>
                                            <span class="tooltip-text" role="tooltip">Also called the Discount Rate. Represents the return you could get by investing your money elsewhere (e.g., stock market) or the rate of inflation. Used for NPV.</span>
                                        </span>
                                    </label>
                                    <input type="number" id="discountRate" value="3.0" min="0" max="20" step="0.1" class="w-full p-2 border border-npv/50 rounded-md focus:ring-npv focus:border-npv">
                                </div>
                                <div class="space-y-1">
                                    <label for="pitiEscalationRate" class="block font-medium text-sm text-red-700">
                                        <span class="tooltip-container">PITI Escalation Rate (%):
                                            <span class="tooltip-icon" tabindex="0" aria-label="PITI Escalation Rate tooltip">?</span>
                                            <span class="tooltip-text" role="tooltip">The estimated annual increase for property taxes and home insurance. Helps model rising costs over time.</span>
                                        </span>
                                    </label>
                                    <input type="number" id="pitiEscalationRate" value="2.0" min="0" max="10" step="0.1" class="w-full p-2 border border-red-300 rounded-md focus:ring-red-500 focus:border-red-500">
                                </div>
                                <div class="space-y-1">
                                    <label for="pmiRate" class="block font-medium text-sm text-gray-700">Annual PMI Rate (%):</label>
                                    <input type="number" id="pmiRate" value="0.5" min="0" max="5" step="0.05" class="w-full p-2 border border-gray-300 rounded-md focus:ring-primary focus:border-primary">
                                </div>
                                <div class="space-y-1">
                                    <label for="propertyTax" class="block font-medium text-sm text-gray-700">Annual Property Tax (<span id="mc-tax-currency"></span>):</label>
                                    <input type="number" id="propertyTax" value="3600" min="0" step="10" class="w-full p-2 border border-gray-300 rounded-md focus:ring-primary focus:border-primary">
                                </div>
                                <div class="space-y-1">
                                    <label for="insurance" class="block font-medium text-sm text-gray-700">Annual Home Insurance (<span id="mc-ins-currency"></span>):</label>
                                    <input type="number" id="insurance" value="1200" min="0" step="10" class="w-full p-2 border border-gray-300 rounded-md focus:ring-primary focus:border-primary">
                                </div>
                                <div class="space-y-1">
                                    <label for="hoa" class="block font-medium text-sm text-gray-700">Monthly HOA Dues (<span id="mc-hoa-currency"></span>):</label>
                                    <input type="number" id="hoa" value="0" min="0" step="10" class="w-full p-2 border border-gray-300 rounded-md focus:ring-primary focus:border-primary">
                                </div>
                                <div class="space-y-1">
                                    <label for="annualMaintenance" class="block font-medium text-sm text-gray-700">
                                        <span class="tooltip-container">Annual Maintenance (% of Value):
                                            <span class="tooltip-icon" tabindex="0" aria-label="Annual Maintenance tooltip">?</span>
                                            <span class="tooltip-text" role="tooltip">Estimated annual cost for upkeep, as a percentage of the home's initial value. Defaults to 1%.</span>
                                        </span>
                                    </label>
                                    <input type="number" id="annualMaintenance" value="1.0" min="0" max="10" step="0.1" class="w-full p-2 border border-gray-300 rounded-md focus:ring-primary focus:border-primary">
                                </div>
                                 <div class="space-y-1">
                                    <label for="monthlyUtilities" class="block font-medium text-sm text-gray-700">Monthly Utilities (<span id="mc-util-currency"></span>):</label>
                                    <input type="number" id="monthlyUtilities" value="300" min="0" step="10" class="w-full p-2 border border-gray-300 rounded-md focus:ring-primary focus:border-primary">
                                </div>
                                <div class="space-y-1">
                                    <label for="extraPayment" class="block font-medium text-sm text-gray-700">Extra Principal (<span id="mc-extra-currency"></span>):</label>
                                    <input type="number" id="extraPayment" value="100" min="0" step="10" class="w-full p-2 border border-gray-300 rounded-md focus:ring-primary focus:border-primary">
                                </div>
                                <div class="space-y-1">
                                    <label for="lumpSumPayment" class="block font-medium text-sm text-gray-700">One-Time Lump Sum (<span id="mc-lump-currency"></span>):</label>
                                    <input type="number" id="lumpSumPayment" value="5000" min="0" step="500" class="w-full p-2 border border-gray-300 rounded-md focus:ring-primary focus:border-primary">
                                </div>
                                <div class="space-y-1">
                                    <label for="lumpSumPeriod" class="block font-medium text-sm text-gray-700">Lump Sum Applied at Period:</label>
                                    <input type="number" id="lumpSumPeriod" value="1" min="1" max="360" class="w-full p-2 border border-gray-300 rounded-md focus:ring-primary focus:border-primary">
                                </div>
                            </div>
                        </details>

                        <details class="bg-white rounded-lg shadow-lg border-2 border-cyan-600">
                            <summary class="p-4 border-b border-gray-200 cursor-pointer flex justify-between items-center relative before:content-['+'] open:before:content-['−'] before:absolute before:right-4 before:text-xl">
                                <h2 class="text-base font-bold text-primary">Refinance Scenario Modeling</h2>
                            </summary>
                            <div class="input-section grid grid-cols-1 sm:grid-cols-2 gap-4 p-4">
                                <div class="space-y-1">
                                    <label for="refiPeriod" class="block font-medium text-sm text-gray-700">Refinance at Period:</label>
                                    <input type="number" id="refiPeriod" value="60" min="1" max="360" step="12" class="w-full p-2 border border-gray-300 rounded-md focus:ring-primary focus:border-primary">
                                </div>
                                <div class="space-y-1">
                                    <label for="refiClosingCosts" class="block font-medium text-sm text-red-700">Refi Closing Costs (<span id="mc-refi-currency"></span>):</label>
                                    <input type="number" id="refiClosingCosts" value="5000" min="0" step="100" class="w-full p-2 border border-red-300 rounded-md focus:ring-red-500 focus:border-red-500">
                                </div>
                                <div class="space-y-1">
                                    <label for="refiRate" class="block font-medium text-sm text-gray-700">New Annual Rate (%):</label>
                                    <input type="number" id="refiRate" value="5.0" min="0.1" max="20" step="0.1" class="w-full p-2 border border-gray-300 rounded-md focus:ring-primary focus:border-primary">
                                </div>
                                <div class="space-y-1">
                                    <label for="refiTerm" class="block font-medium text-sm text-gray-700">New Term (Years):</label>
                                    <input type="number" id="refiTerm" value="15" min="1" max="30" step="1" class="w-full p-2 border border-gray-300 rounded-md focus:ring-primary focus:border-primary">
                                </div>
                            </div>
                        </details>

                        <details class="bg-white rounded-lg shadow-lg border-2 border-cyan-600">
                            <summary class="p-4 border-b border-gray-200 cursor-pointer flex justify-between items-center relative before:content-['+'] open:before:content-['−'] before:absolute before:right-4 before:text-xl">
                                <h2 class="text-base font-bold text-primary">Interest Rate Shock Test</h2>
                            </summary>
                            <div class="input-section p-4">
                                <div class="space-y-1">
                                    <label for="shockRateIncrease" class="block font-medium text-sm text-gray-700">Model Future Rate Increase by (%):</label>
                                    <div class="flex gap-2 mt-1">
                                        <input type="number" id="shockRateIncrease" value="1.0" min="0.1" max="5" step="0.1" class="flex-grow p-2 border border-gray-300 rounded-md focus:ring-red-500 focus:border-red-500">
                                        <button onclick="handleCalculation(true)" class="bg-red-500 hover:bg-red-600 text-white font-semibold rounded-lg shadow-md transition duration-150 py-2 px-4 w-1/2">
                                            Run Shock Test
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </details>
                    </div>
                    
                    <div class="output-column flex flex-col gap-4 lg:col-span-3">

                        <div id="results" class="p-4 bg-gray-50 rounded-lg shadow-inner border border-gray-200 opacity-0" aria-live="polite" aria-atomic="true">
                            <div class="text-center sm:flex sm:justify-between sm:items-center mb-2">
                                <h2 class="text-lg sm:text-xl font-bold text-gray-800">Calculation Summary</h2>
                                <div class="no-print flex justify-center space-x-2 mt-2 sm:mt-0">
                                    <button onclick="generatePDF()" class="p-2 rounded-md hover:bg-gray-200 transition-colors" aria-label="Download PDF Report" title="Download PDF Report">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" viewBox="0 0 16 16">
                                            <path d="M.5 9.9a.5.5 0 0 1 .5.5v2.5a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1v-2.5a.5.5 0 0 1 1 0v2.5a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2v-2.5a.5.5 0 0 1 .5-.5z"/>
                                            <path d="M7.646 11.854a.5.5 0 0 0 .708 0l3-3a.5.5 0 0 0-.708-.708L8.5 10.293V1.5a.5.5 0 0 0-1 0v8.793L5.354 8.146a.5.5 0 1 0-.708.708l3 3z"/>
                                        </svg>
                                    </button>
                                    <button onclick="window.print()" class="p-2 rounded-md hover:bg-gray-200 transition-colors" aria-label="Print Results" title="Print Results">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" viewBox="0 0 16 16">
                                            <path d="M5 1a2 2 0 0 0-2 2v2H2a2 2 0 0 0-2 2v3a2 2 0 0 0 2 2h1v1a2 2 0 0 0 2 2h6a2 2 0 0 0 2-2v-1h1a2 2 0 0 0 2-2V7a2 2 0 0 0-2-2h-1V3a2 2 0 0 0-2-2H5zM4 3a1 1 0 0 1 1-1h6a1 1 0 0 1 1 1v2H4V3zm1 5a2 2 0 0 0-2 2v1H2a1 1 0 0 1-1-1V7a1 1 0 0 1 1-1h12a1 1 0 0 1 1 1v3a1 1 0 0 1-1 1h-1v-1a2 2 0 0 0-2-2H5zm7 2v3a1 1 0 0 1-1 1H5a1 1 0 0 1-1-1v-3a1 1 0 0 1 1-1h6a1 1 0 0 1 1 1z"/>
                                            <path d="M2.5 8a.5.5 0 1 0 0-1 .5.5 0 0 0 0 1z"/>
                                        </svg>
                                    </button>
                                </div>
                            </div>
                            
                            <p class="text-sm sm:text-base py-2 font-bold">Estimated Initial Monthly Payment (PITI + PMI): <span id="totalMonthlyPaymentPITI" class="text-primary"></span></p>

                            <div class="mt-2 p-3 text-center bg-primary/10 rounded-lg border-2 border-primary/50 shadow">
                                <h3 class="text-sm sm:text-base font-bold text-primary">Total Monthly Cost of Ownership</h3>
                                <p id="totalOwnershipCost" class="text-xl sm:text-2xl font-extrabold text-primary"></p>
                                <p class="text-xs text-gray-600">(PITI + Maintenance + Utilities)</p>
                            </div>
                            
                            <p class="text-xs text-red-600 text-center p-2 border-dashed border border-amber-500 bg-amber-50 rounded-md mt-2" id="pmiDropNote" style="display: none;">
                                PMI included until period <span id="pmiDropPeriod" class="font-bold"></span>, when LTV drops to 80%.
                            </p>

                            <div id="dti-results" class="mt-4 p-3 rounded-lg bg-white shadow-md" aria-live="polite">
                                <h3 id="dti-title" class="text-base sm:text-lg font-bold text-gray-800 mb-2 border-b pb-1">Debt-to-Income (DTI) Analysis</h3>
                                <div class="grid grid-cols-2 gap-4 text-center">
                                    <div class="p-2 rounded-lg bg-gray-50 border">
                                        <p class="text-xs font-medium text-gray-600">Front-End DTI (Housing)</p>
                                        <p id="frontEndDTI" class="text-lg sm:text-xl font-extrabold"></p>
                                        <p id="frontEndDTIStatus" class="text-xs font-semibold mt-1"></p>
                                    </div>
                                    <div class="p-2 rounded-lg bg-gray-50 border">
                                        <p class="text-xs font-medium text-gray-600">Back-End DTI (Total Debt)</p>
                                        <p id="backEndDTI" class="text-lg sm:text-xl font-extrabold"></p>
                                        <p id="backEndDTIStatus" class="text-xs font-semibold mt-1"></p>
                                    </div>
                                </div>
                            </div>

                            <div id="equity-summary" class="mt-4 p-3 rounded-lg border border-accent/50 bg-white shadow-md" aria-live="polite">
                                <h3 class="text-base sm:text-lg font-bold text-accent mb-2 border-b pb-1">Projected Equity Growth</h3>
                                <div class="grid grid-cols-2 gap-4 text-center">
                                     <div class="p-2 rounded-lg bg-gray-50 border">
                                        <p class="text-xs font-medium text-gray-600">Total Equity at Payoff</p>
                                        <p id="finalEquity" class="text-lg sm:text-xl font-extrabold text-accent" data-value="0"></p>
                                    </div>
                                    <div class="p-2 rounded-lg bg-gray-50 border">
                                        <p class="text-xs font-medium text-gray-600">Final Property Value</p>
                                        <p id="finalPropertyValue" class="text-lg sm:text-xl font-extrabold text-accent" data-value="0"></p>
                                    </div>
                                </div>
                            </div>
                            
                            <div id="chartContainer" class="mt-4 bg-white rounded-lg shadow-md p-2">
                                <canvas id="comparisonChart"></canvas>
                            </div>

                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mt-4 text-sm">
                                <div class="bg-gray-100 p-3 rounded-lg border border-gray-200">
                                    <h3 class="text-base font-semibold text-gray-700 mb-1">Original Loan (Standard)</h3>
                                    <p>P&I Payment: <span id="standardPaymentDisplay"></span></p>
                                    <p>Payoff Date: <span id="originalPayoffDate"></span></p>
                                    <p class="mt-2 text-primary font-bold">Total Interest Paid: <span id="totalInterestOriginal" data-value="0"></span></p>
                                    <p class="text-npv font-bold">NPV of Interest Cost: <span id="npvOriginal" data-value="0"></span></p>
                                </div>
                                <div class="bg-gray-100 p-3 rounded-lg border border-gray-200">
                                    <h3 class="text-base font-semibold text-gray-700 mb-1">Accelerated Scenario</h3>
                                    <p>Accelerated P&I Payment: <span id="acceleratedPaymentDisplay"></span></p>
                                    <p>New Payoff Date: <span id="newPayoffDate" class="text-accent font-bold"></span></p>
                                    <p class="mt-2 text-primary font-bold">Total Interest Paid: <span id="totalInterestNew" data-value="0"></span></p>
                                    <p class="text-npv font-bold">NPV of Interest Cost: <span id="npvNew" data-value="0"></span></p>
                                </div>
                            </div>
                            
                            <p class="text-md mt-4 p-2 bg-accent/10 rounded-lg text-center font-medium">
                                You saved <span class="text-accent font-extrabold" id="interestSaved" data-value="0"></span> in Nominal Interest and shaved off <span class="text-accent font-extrabold" id="timeSaved"></span> from the loan term!
                            </p>
                            
                            <p class="text-md mt-2 p-2 bg-npv/10 rounded-lg text-center font-medium border-l-4 border-npv">
                                 NPV Savings: <span class="text-npv font-extrabold" id="npvSaved" data-value="0"></span> (The true value saved in today's dollars).
                            </p>
                        </div>
                        
                        <div id="shock-results" class="p-4 bg-red-100 rounded-lg shadow-inner border border-red-300" style="display: none;" aria-live="assertive" aria-atomic="true">
                            <h3 class="text-lg font-bold text-red-700 mb-2">Interest Rate Shock Test Result</h3>
                            <p class="text-lg">New Rate: <span id="shockRateDisplay" class="text-red-600 font-bold"></span>%</p>
                            <p>Original P&I Payment: <span id="originalShockPaymentDisplay"></span></p>
                            <p class="text-lg py-1">New Shock P&I Payment: <span id="shockPaymentDisplay" class="text-red-600 font-bold"></span> (Increase of <span id="paymentIncrease" class="text-red-600 font-bold"></span>)</p>
                        </div>

                        <div id="schedule-wrapper" class="bg-white rounded-lg shadow-lg border border-gray-200">
                            <details>
                                <summary class="p-4 border-b border-gray-200 cursor-pointer flex justify-between items-center relative before:content-['+'] open:before:content-['−'] before:absolute before:right-4 before:text-xl">
                                    <h3 class="text-base font-bold text-primary">View Amortization Schedule</h3>
                                </summary>
                                <div id="schedule" class="overflow-x-auto max-w-full p-4">
                                    <table id="amortizationTable" class="min-w-[1200px] w-full border-collapse"></table>
                                    <p class="text-center text-xs text-primary/80 mt-2 italic">
                                        ← Scroll for full comparison →
                                    </p>
                                </div>
                            </details>
                        </div>
                        
                    </div>
                </div>
            </div>

            <div id="rent-vs-buy-content" class="hidden">
                 <div class="main-grid-layout grid grid-cols-1 gap-6 mt-4 lg:grid-cols-5">
                    <div class="input-column flex flex-col gap-4 lg:col-span-2">
                        <details open class="bg-white rounded-lg shadow-lg border-2 border-cyan-600">
                             <summary class="p-4 border-b border-gray-200 cursor-pointer flex justify-between items-center relative before:content-['+'] open:before:content-['−'] before:absolute before:right-4 before:text-xl">
                                <h2 class="text-base font-bold text-primary">Rent vs. Buy Inputs</h2>
                            </summary>
                            <div class="p-4 grid grid-cols-1 sm:grid-cols-2 gap-4">
                                <div class="space-y-1">
                                    <label for="monthlyRent" class="block font-medium text-sm text-gray-700">Equivalent Monthly Rent (<span id="rvb-rent-currency"></span>):</label>
                                    <input type="number" id="monthlyRent" value="2000" min="100" step="100" class="w-full p-2 border border-gray-300 rounded-md focus:ring-primary focus:border-primary">
                                </div>
                                <div class="space-y-1">
                                    <label for="rentIncrease" class="block font-medium text-sm text-gray-700">Annual Rent Increase (%):</label>
                                    <input type="number" id="rentIncrease" value="3.0" min="0" max="15" step="0.1" class="w-full p-2 border border-gray-300 rounded-md focus:ring-primary focus:border-primary">
                                </div>
                                <div class="space-y-1 sm:col-span-2">
                                    <label for="investmentReturn" class="block font-medium text-sm text-gray-700">
                                        <span class="tooltip-container">Annual Investment Return (%):
                                            <span class="tooltip-icon" tabindex="0" aria-label="Annual Investment Return tooltip">?</span>
                                            <span class="tooltip-text" role="tooltip">The average annual return you expect on investments if you were to rent and invest your down payment and cost differences.</span>
                                        </span>
                                    </label>
                                    <input type="number" id="investmentReturn" value="7.0" min="0" max="20" step="0.1" class="w-full p-2 border border-gray-300 rounded-md focus:ring-primary focus:border-primary">
                                </div>
                                 <div class="space-y-1">
                                    <label for="closingCosts" class="block font-medium text-sm text-gray-700">Upfront Buying Costs (<span id="rvb-closing-costs-currency"></span>):</label>
                                    <input type="number" id="closingCosts" value="8000" min="0" step="100" class="w-full p-2 border border-gray-300 rounded-md focus:ring-primary focus:border-primary">
                                </div>
                                <div class="space-y-1">
                                    <label for="sellingCosts" class="block font-medium text-sm text-gray-700">Home Selling Costs (%):</label>
                                    <input type="number" id="sellingCosts" value="6.0" min="0" max="15" step="0.1" class="w-full p-2 border border-gray-300 rounded-md focus:ring-primary focus:border-primary">
                                </div>
                            </div>
                        </details>
                    </div>

                    <div class="output-column flex flex-col gap-4 lg:col-span-3">
                        <div id="rent-vs-buy-results" class="p-4 bg-gray-50 rounded-lg shadow-inner border border-gray-200 opacity-0">
                             <h2 class="text-xl sm:text-2xl font-bold text-gray-800 text-center mb-4">Rent vs. Buy Summary</h2>
                             <div id="rent-vs-buy-chart-container" class="mt-4 bg-white rounded-lg shadow-md p-2">
                                <canvas id="rentVsBuyChart"></canvas>
                            </div>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mt-4 text-sm">
                                <div class="bg-green-50 p-3 rounded-lg border border-green-200">
                                    <h3 class="text-base font-semibold text-green-800 mb-1">Buying Outcome</h3>
                                    <p>Projected Net Worth:</p>
                                    <p id="buyingNetWorth" class="text-xl sm:text-2xl font-bold text-green-700"></p>
                                </div>
                                <div class="bg-blue-50 p-3 rounded-lg border border-blue-200">
                                    <h3 class="text-base font-semibold text-blue-800 mb-1">Renting Outcome</h3>
                                    <p>Projected Net Worth:</p>
                                    <p id="rentingNetWorth" class="text-xl sm:text-2xl font-bold text-blue-700"></p>
                                </div>
                            </div>
                            <div class="mt-4 p-3 rounded-lg text-center" id="rent-vs-buy-conclusion">
                                <!-- Conclusion will be inserted here -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="flex flex-col sm:flex-row gap-3 md:gap-4 mt-6">
                <button id="calculateButton" onclick="handleCalculation()" class="w-full px-4 py-3 bg-primary text-white font-semibold rounded-lg shadow-xl hover:bg-sky-700 transition duration-150 min-h-11">
                    Calculate Scenario
                </button>
                <button id="resetButton" onclick="resetForm()" class="w-full px-4 py-3 bg-gray-200 text-gray-700 font-semibold rounded-lg shadow-md hover:bg-gray-300 transition duration-150 min-h-11">
                    Reset to Defaults
                </button>
            </div>
             <button id="saveButton" class="w-full mt-3 px-4 py-3 bg-accent/80 text-white font-semibold rounded-lg shadow-lg hover:bg-accent transition duration-150 min-h-11">
                Save & Share Scenario
            </button>
        </div>

        <!-- SEO Content Section -->
        <div id="guide-content" class="no-print">
            <!-- SEO Content will be loaded here by default -->
        </div>
    </main>

    <!-- Global Footer -->
    <footer class="bg-gray-800 text-gray-400 text-sm no-print">
        <div class="container mx-auto px-4 sm:px-6 lg:px-8 py-8">
            <div class="text-center text-xs">
                <p>&copy; <span id="copyright-year">2025</span> Strategic Mortgage Planner. All Rights Reserved. | <a href="legal.html" class="hover:text-white underline">Contact & Legal</a></p>
                <p class="mt-1">A part of <a href="https://toolblaster.com" target="_blank" class="text-white hover:underline font-semibold">toolblaster.com</a> Network</p>
                 <p class="mt-1"><strong>Disclaimer:</strong> This tool is for informational purposes only. Consult a financial professional before making decisions.</p>
            </div>
        </div>
    </footer>

    <!-- Save & Share Modal -->
    <div id="shareModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50 hidden" role="dialog" aria-modal="true" aria-labelledby="modal-title">
        <div class="bg-white rounded-lg shadow-xl w-full max-w-md p-6">
            <h2 id="modal-title" class="text-xl font-bold text-primary mb-4">Share Your Scenario</h2>
            <p class="text-sm text-gray-600 mb-2">Copy the link below to save and share your personalized mortgage calculation.</p>
            <div class="flex items-center space-x-2">
                <input type="text" id="shareUrlInput" readonly class="w-full p-2 border border-gray-300 rounded-md bg-gray-100 focus:outline-none">
                <button id="copyUrlButton" class="px-4 py-2 bg-primary text-white font-semibold rounded-lg hover:bg-sky-700 transition duration-150">Copy</button>
            </div>
            <p id="copyFeedback" class="text-sm text-accent mt-2 h-5"></p>
            <button id="closeModalButton" class="w-full mt-4 px-4 py-2 bg-gray-200 text-gray-700 font-semibold rounded-lg hover:bg-gray-300 transition duration-150">Close</button>
        </div>
    </div>

    <!-- Page-Specific and Global Scripts -->
    <script src="app.js" defer></script>
</body>
</html>
